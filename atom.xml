<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>技术随手记</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://jishusuishouji.github.io/"/>
  <updated>2017-01-09T14:36:01.677Z</updated>
  <id>http://jishusuishouji.github.io/</id>
  
  <author>
    <name>技术随手记</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring MVC事务配置</title>
    <link href="http://jishusuishouji.github.io/2017/01/09/java/spring/Spring_MVC%E4%BA%8B%E5%8A%A1%E9%85%8D%E7%BD%AE/"/>
    <id>http://jishusuishouji.github.io/2017/01/09/java/spring/Spring_MVC事务配置/</id>
    <published>2017-01-09T14:36:01.000Z</published>
    <updated>2017-01-09T14:36:01.677Z</updated>
    
    <summary type="html">
    
      Spring MVC事务配置
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>是该抛弃Spring HibernateTemplate的时候了</title>
    <link href="http://jishusuishouji.github.io/2017/01/09/java/spring/%E6%98%AF%E8%AF%A5%E6%8A%9B%E5%BC%83Spring_HibernateTemplate%E7%9A%84%E6%97%B6%E5%80%99%E4%BA%86/"/>
    <id>http://jishusuishouji.github.io/2017/01/09/java/spring/是该抛弃Spring_HibernateTemplate的时候了/</id>
    <published>2017-01-09T14:26:48.000Z</published>
    <updated>2017-01-09T14:34:52.368Z</updated>
    
    <content type="html"><![CDATA[<p>在spring2.0之前，我们在使用hibernate和spring的时候，都会被<code>HibernateTemplate</code>为我们提供benefits（资源和事务管理以及把那个“丑陋”的checked exception转换为runtime exception-DataAccessException ）而折服，在项目中不由自主、不假思索地使用它和那个经典的callback方法。而如今，hibernate3.0.1+ 、spring 2.0+版本以后，我们可以在数据访问层直接使用hinberate的session API(例如<code>SessionFactory.getCurrentSession</code>)，不并担心session和transaction management。至于error handling可以通过spring的@Repository annotation和post processor-PersistenceExceptionTranslationPostProcessor来解决。让我们来看一些代码片段：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;sessionFactory&quot; class=&quot;org.springframework.orm.hibernate3.  </div><div class="line">LocalSessionFactoryBean&quot;&gt;  </div><div class="line">&lt;!-- the properties setting--&gt;  </div><div class="line">&lt;/bean&gt;  </div><div class="line">   </div><div class="line">&lt;bean id=&quot;accountRepo&quot; class=&quot;com.mycompany.HibernateAccountRepository&quot;&gt;  </div><div class="line">    &lt;constructor-arg ref=&quot;sessionFactory&quot;&gt;&lt;/constructor-arg&gt;  </div><div class="line">&lt;/bean&gt;  </div><div class="line">&lt;bean class=&quot;org.springframework.dao.annotation. PersistenceExceptionTranslationPostProcessor&quot;/&gt;</div></pre></td></tr></table></figure></p>
<p>数据访问层代码片段：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@Repository  </div><div class="line">public class HibernateAccountRepository implements AccountRepository &#123;  </div><div class="line">   </div><div class="line">    private SessionFactory factory;  </div><div class="line">   </div><div class="line">    public HibernateAccountRepository(SessionFactory factory) &#123;  </div><div class="line">        this.factory = factory;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    public Account loadAccount(String username) &#123;  </div><div class="line">        return (Account)factory.getCurrentSession()</div><div class="line">                  .createQuery(&quot;from Account acc where acc.name = :name&quot;)  </div><div class="line">                  .setParameter(&quot;name&quot;, &quot;thethirdpart&quot;).uniqueResult();  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在xml配置文件里面通过配置的post processor会自动检测<code>@Repository</code>标注的bean并为该bean打开exception转换功能。    </p>
<p>如果不支持annotations，可以通过AOP来实现，更方便<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;persistenceExceptionInterceptor&quot;  </div><div class="line">class=&quot;org.springframework.dao.support.PersistenceExceptionTranslationInterceptor&quot;/&gt;  </div><div class="line">&lt;aop:config&gt;  </div><div class="line">    &lt;aop:advisor pointcut=&quot;execution(* *..*Repository+.*(..))&quot;  </div><div class="line">                          advice-ref=&quot;persistenceExceptionInterceptor&quot; /&gt;  </div><div class="line">&lt;/aop:config&gt;</div></pre></td></tr></table></figure></p>
<p>总结，我们应该选择哪种方式呢？还是那句话，根据不同的情况来做最正确的选择。但我建议是丢弃template，而直接使用hibernate的API，毕竟灵活性更大，更何况遇到复杂的情况我们始终得面对hibernate的API。spring并不强制你做任何事情，记得它是一个非侵入性的framework。</p>
]]></content>
    
    <summary type="html">
    
      是该抛弃Spring HibernateTemplate的时候了
    
    </summary>
    
      <category term="java" scheme="http://jishusuishouji.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://jishusuishouji.github.io/tags/java/"/>
    
      <category term="spring" scheme="http://jishusuishouji.github.io/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>So should you still use Spring&#39;s HibernateTemplate and/or JpaTemplate??</title>
    <link href="http://jishusuishouji.github.io/2017/01/09/java/spring/So_should_you_still_use_Spring_s_HibernateTemplate_and_or_JpaTemplate__/"/>
    <id>http://jishusuishouji.github.io/2017/01/09/java/spring/So_should_you_still_use_Spring_s_HibernateTemplate_and_or_JpaTemplate__/</id>
    <published>2017-01-09T14:20:51.000Z</published>
    <updated>2017-01-09T14:36:54.486Z</updated>
    
    <content type="html"><![CDATA[<p>I was reading <a href="http://www.infoq.com/articles/dynamic-routing-using-spring" target="_blank" rel="external">an article by Vigil Bose</a> on TSS the other day and saw the usage of the <code>HibernateDaoSupport</code> class. Since this is no longer a recommended way of using Hibernate from Spring, I thought I might as well just blog about it another time.   </p>
<p>不建议使用<code>HibernateDaoSupport</code>。   </p>
<p>With the advent(n. 到来；出现；) of Spring 2.0, it has become possible to start using the Hibernate Session API directly again. The question is whether or not it is wise to abandon the use of the <code>HibernateTemplate</code> when working with Hibernate, or any other template-based approaches Spring features.  </p>
<h2 id="Using-Spring-XxxTemplates"><a href="#Using-Spring-XxxTemplates" class="headerlink" title="Using Spring XxxTemplates"></a>Using Spring XxxTemplates</h2><p>In Spring 1.0, we introduced a revolutionary way of working with data access APIs that threw checked exceptions. The template approach Spring features along with its transaction synchronization manager and the extensive use of runtime exceptions makes any TCFTC (short for try/catch-finally-try/catch as we coined it back in 2005) often found in data access code entirely obsolete. Below you can see (a simplified version and not entirely precise version of) what Spring’s template approach does for you (with specific code snippets that you would otherwise have to write).</p>
]]></content>
    
    <summary type="html">
    
      So should you still use Spring&#39;s HibernateTemplate and/or JpaTemplate??
    
    </summary>
    
      <category term="java" scheme="http://jishusuishouji.github.io/categories/java/"/>
    
      <category term="spring" scheme="http://jishusuishouji.github.io/categories/java/spring/"/>
    
    
      <category term="java" scheme="http://jishusuishouji.github.io/tags/java/"/>
    
      <category term="spring" scheme="http://jishusuishouji.github.io/tags/spring/"/>
    
      <category term="hibernate" scheme="http://jishusuishouji.github.io/tags/hibernate/"/>
    
      <category term="HibernateTemplate" scheme="http://jishusuishouji.github.io/tags/HibernateTemplate/"/>
    
  </entry>
  
  <entry>
    <title>java分布式事务(JTA)实现 jotm和atomikos</title>
    <link href="http://jishusuishouji.github.io/2017/01/08/java/jta/java%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1_JTA_%E5%AE%9E%E7%8E%B0%20jotm%E5%92%8Catomikos/"/>
    <id>http://jishusuishouji.github.io/2017/01/08/java/jta/java分布式事务_JTA_实现 jotm和atomikos/</id>
    <published>2017-01-08T02:03:52.000Z</published>
    <updated>2017-01-08T08:17:24.019Z</updated>
    
    <content type="html"><![CDATA[<p>本地事务：只对单一数据源(单个数据库)事务进行控制。<br>分布式事务：处理多种异构的数据源， 比如某个业务操作中同时包含JDBC和JMS或者某个操作需要访问多个不同的数据库，在不同数据库之间进行事务控制。</p>
<p>在Java中，分布式事务主要的规范是JTA/XA。其中：JTA是Java的事务管理器规范，XA是工业标准的X/Open CAE规范，可被两阶段提交及回滚的事务资源定义。比如某数据库实现了XA规范，则不管是JTA，还是MSDTC，都可以基于同样的行为对该数据库进行事务处理。</p>
<p>JTA全称为Java Transaction API，顾名思义JTA定义了一组统一的事务编程的接口，这些接口如下：</p>
<p><code>XAResource</code>：XAResource接口是对实现了X/Open CAE规范的资源管理器 (Resource Manager，数据库就是典型的资源管理器) 的抽象，它由资源适配器 (Resource Apdater) 提供实现。<code>XAResource</code>是支持事务控制的核心。<br><code>Transaction</code>：<code>Transaction</code>接口是一个事务实例的抽象，通过它可以控制事务内多个资源的提交或者回滚。二阶段提交过程也是由<code>Transaction</code>接口的实现者来完成的。<br><code>TransactionManager</code>：托管模式 (managed mode)   下，<code>TransactionManager</code>接口是被应用服务器调用，以控制事务的边界的。<br><code>UserTransaction</code>：非托管模式 (non-managed mode) 下，应用程序可以通过<code>UserTransaction</code>接口控制事务的边界</p>
<p>在tomcat下是没有分布式事务的，可以借助于第三方Jotm和Automikos实现，在spring中分布式事务是通过jta（jotm，atomikos）来进行实现。即：通过代码的方式来决定是否是分布式事务。</p>
<p>注：推荐用服务器自己的数据源(也就是 lookup JNDI)，这样的话，是不是XA事务就由服务器的配置来定制，代码就不需要任何配置来决定是不是XA了。<br>事务本身是不是XA (分布式的）是服务器的事，服务器来管理“资源” （包括数据源，JMS 连接等，一个资源（JDBC连接）如何参与事务是“资源管理器”（驱动程序）的职责，跟程序无关），服务器提供事务管理并作为“事务协调者”来处理多个“资源管理器”（不同的数据库连接）之间的事务一致性。</p>
<p>jotm和automikos网址：<br>1、<a href="http://jotm.objectweb.org/" target="_blank" rel="external">http://jotm.objectweb.org/</a><br>2、<a href="http://www.atomikos.com/Main/TransactionsEssentials" target="_blank" rel="external">http://www.atomikos.com/Main/TransactionsEssentials</a> </p>
<p>Spring 通过AOP技术可以让我们在脱离EJB的情况下享受声明式事务的丰盛大餐。此外，通过配合使用ObjectWeb的JOTM开源项目，不需要Java EE应用服务器，Spring也可以提供JTA事务。 </p>
<p>正因为AOP让Spring拥有了脱离EJB容器的声明式事务能力，而JOTM让我们在脱离Java EE应用服务器下拥有JTA事务能力。所以，人们将AOP和JOTM称为Java软件开发的两个圣杯。    </p>
<p>JTA的实现框架有：<br>GeronimoTM/Jencks  官方文档比较少，不适合学习和维护。<br>SimpleJTA 没有实现JTS (Java Transaction Service)而且不是活跃的。<br>Atomikos  是一个另人钦佩的产品。有丰富的文档，而且有很好的支持。<br>JBossTS  是一个应用在JBOSS服务器上的，肯定是一个成熟的产品，也有好的支持，详细信息可以看这里：<a href="http://www.theserverside.com/news/thread.tss?thread_id=37941" target="_blank" rel="external">http://www.theserverside.com/news/thread.tss?thread_id=37941</a><br>最常见的二个如下：<br>JOTM<br>    JOTM(Java Open Transaction Manager)是ObjectWeb的一个开源JTA实现，它本身也是开源应用程序服务器JOnAS(Java Open Application Server)的一部分，为其提供JTA分布式事务的功能。<br>    存在的问题：使用中不能自动rollback，无论什么情况都commit。注：spring3开始已经不再支持jotm</p>
<p>Atomikos<br>    大家推荐最多的。和JOTM相比Atomikos Transactions Essentials更加稳定，它原来是商业项目，现在开源了。象MySQL一样卖服务支持的。而且论坛页比较活跃，有问题很快可以解决。 </p>
]]></content>
    
    <summary type="html">
    
      java分布式事务(JTA)实现 jotm和atomikos
    
    </summary>
    
      <category term="java" scheme="http://jishusuishouji.github.io/categories/java/"/>
    
      <category term="jta" scheme="http://jishusuishouji.github.io/categories/java/jta/"/>
    
    
      <category term="java" scheme="http://jishusuishouji.github.io/tags/java/"/>
    
      <category term="jta" scheme="http://jishusuishouji.github.io/tags/jta/"/>
    
      <category term="分布式事务" scheme="http://jishusuishouji.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/"/>
    
      <category term="jotm" scheme="http://jishusuishouji.github.io/tags/jotm/"/>
    
      <category term="atomikos" scheme="http://jishusuishouji.github.io/tags/atomikos/"/>
    
  </entry>
  
  <entry>
    <title>java分布式事务:spring+JTA+jotm</title>
    <link href="http://jishusuishouji.github.io/2017/01/08/java/jta/java%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1_spring_JTA_jotm/"/>
    <id>http://jishusuishouji.github.io/2017/01/08/java/jta/java分布式事务_spring_JTA_jotm/</id>
    <published>2017-01-08T01:23:24.000Z</published>
    <updated>2017-01-08T08:18:52.796Z</updated>
    
    <content type="html"><![CDATA[<h2 id="业务背景"><a href="#业务背景" class="headerlink" title="业务背景"></a>业务背景</h2><p>当新建用户时需插入一条用户记录，同时还需在另一个DB中记录日志。因为是不同的DB操作，所以及到分布式事务的处理。</p>
<h3 id="1、代码结构："><a href="#1、代码结构：" class="headerlink" title="1、代码结构："></a>1、代码结构：</h3><p><img src="http://img.blog.csdn.net/20150209142444553?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbGl1eGlhbzcyMzg0Ng==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="项目在eclipse中"></p>
<h3 id="2、建表语句："><a href="#2、建表语句：" class="headerlink" title="2、建表语句："></a>2、建表语句：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">create database log;  </div><div class="line">DROP TABLE IF EXISTS `log`;  </div><div class="line">CREATE TABLE `log` (  </div><div class="line">  `id` varchar(20) NOT NULL,  </div><div class="line">  `content` varchar(100) default NULL,  </div><div class="line">  PRIMARY KEY  (`id`)  </div><div class="line">);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">create database user;  </div><div class="line">DROP TABLE IF EXISTS `user`;  </div><div class="line">CREATE TABLE `user` (  </div><div class="line">  `id` varchar(20) NOT NULL,  </div><div class="line">  `name` varchar(40) default NULL,  </div><div class="line">  PRIMARY KEY  (`id`)  </div><div class="line">);</div></pre></td></tr></table></figure>
<h3 id="3、配置文件application-xml"><a href="#3、配置文件application-xml" class="headerlink" title="3、配置文件application.xml"></a>3、配置文件<code>application.xml</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">&lt;!--?xml version=1.0 encoding=UTF-8?--&gt;  </div><div class="line">&lt;beans aop=&quot;&quot; beans=&quot;&quot; http:=&quot;&quot; schema=&quot;&quot; spring-aop.xsd=&quot;&quot; spring-beans.xsd=&quot;&quot; spring-tx.xsd=&quot;&quot; tx=&quot;&quot; www.springframework.org=&quot;&quot; xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot; xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemalocation=&quot;http://www.springframework.org/schema/beans&quot;&gt;  </div><div class="line">       </div><div class="line">    &lt;!-- 引用Spring内部所提供的对JOTM支持的工厂类 --&gt;  </div><div class="line">    &lt;bean class=&quot;org.springframework.transaction.jta.JotmFactoryBean&quot; id=&quot;jotm&quot;/&gt;  </div><div class="line">       </div><div class="line">    &lt;!-- 配置JTA事务管理器, 并在管理器中使用上面所配置的JOTM --&gt;  </div><div class="line">    &lt;bean class=&quot;org.springframework.transaction.jta.JtaTransactionManager&quot; id=&quot;txManager&quot;&gt;  </div><div class="line">        &lt;property name=&quot;userTransaction&quot; ref=&quot;jotm&quot;/&gt;</div><div class="line">    &lt;/bean&gt;  </div><div class="line">       </div><div class="line">    &lt;!-- 配置多个数据源 --&gt;  </div><div class="line">    &lt;bean class=&quot;org.enhydra.jdbc.pool.StandardXAPoolDataSource&quot; destroy-method=&quot;shutdown&quot; id=&quot;db1&quot;&gt;  </div><div class="line">        &lt;property name=&quot;dataSource&quot;&gt;  </div><div class="line">            &lt;bean class=&quot;org.enhydra.jdbc.standard.StandardXADataSource&quot; destroy-method=&quot;shutdown&quot;&gt;  </div><div class="line">                &lt;property name=&quot;transactionManager&quot; ref=&quot;jotm&quot;/&gt;  </div><div class="line">                &lt;property name=&quot;driverName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;  </div><div class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:MySQL://localhost:3306/user&quot;/&gt;  </div><div class="line">            &lt;/bean&gt;  </div><div class="line">        &lt;/property&gt;  </div><div class="line">        &lt;property name=&quot;user&quot; value=&quot;root&quot;/&gt;  </div><div class="line">        &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;  </div><div class="line">    &lt;/bean&gt;  </div><div class="line">   </div><div class="line">    &lt;bean class=&quot;org.enhydra.jdbc.pool.StandardXAPoolDataSource&quot; destroy-method=&quot;shutdown&quot; id=&quot;db2&quot;&gt;  </div><div class="line">        &lt;property name=&quot;dataSource&quot;&gt;  </div><div class="line">            &lt;bean class=&quot;org.enhydra.jdbc.standard.StandardXADataSource&quot; destroy-method=&quot;shutdown&quot;&gt;  </div><div class="line">                &lt;property name=&quot;transactionManager&quot; ref=&quot;jotm&quot;/&gt;  </div><div class="line">                &lt;property name=&quot;driverName&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;  </div><div class="line">                &lt;property name=&quot;url&quot; value=&quot;jdbc:MySQL://localhost:3306/log&quot;/&gt;  </div><div class="line">            &lt;/bean&gt;  </div><div class="line">        &lt;/property&gt;  </div><div class="line">        &lt;property name=&quot;user&quot; value=&quot;root&quot;/&gt;  </div><div class="line">        &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;  </div><div class="line">    &lt;/bean&gt;  </div><div class="line">       </div><div class="line">    &lt;!-- 根据不同的数据源配置两个jdbcTemplate --&gt;  </div><div class="line">    &lt;bean class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot; id=&quot;jdbcTemplate1&quot;&gt;  </div><div class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;db1&quot;/&gt;  </div><div class="line">    &lt;/bean&gt;  </div><div class="line">   </div><div class="line">    &lt;bean class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot; id=&quot;jdbcTemplate2&quot;&gt;  </div><div class="line">        &lt;property name=&quot;dataSource&quot; ref=&quot;db2&quot;/&gt;  </div><div class="line">    &lt;/bean&gt;  </div><div class="line">   </div><div class="line">    &lt;bean class=&quot;com.zdp.dao.UserDao&quot; id=&quot;userDao&quot;&gt;  </div><div class="line">        &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate1&quot;/&gt;  </div><div class="line">    &lt;/bean&gt;  </div><div class="line">   </div><div class="line">    &lt;bean class=&quot;com.zdp.dao.LogDao&quot; id=&quot;logDao&quot;&gt;  </div><div class="line">        &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate2&quot;/&gt;  </div><div class="line">    &lt;/bean&gt;  </div><div class="line">   </div><div class="line">    &lt;bean class=&quot;com.zdp.service.UserService&quot; id=&quot;userService&quot;/&gt;  </div><div class="line">        &lt;property name=&quot;userDao&quot; ref=&quot;userDao&quot;/&gt;  </div><div class="line">        &lt;property name=&quot;logDao&quot; ref=&quot;logDao&quot;/&gt;  </div><div class="line">    &lt;/bean&gt;  </div><div class="line">       </div><div class="line">    &lt;!-- JTA事务传播特性 --&gt;  </div><div class="line">    &lt;tx:advice id=&quot;txAdviceJTA&quot; transaction-manager=&quot;txManager&quot;&gt;  </div><div class="line">        &lt;tx:attributes&gt;  </div><div class="line">            &lt;tx:method isolation=&quot;DEFAULT&quot; name=&quot;save*&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;Exception/&quot;&gt;  </div><div class="line">            &lt;tx:method isolation=&quot;DEFAULT&quot; name=&quot;add*&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;Exception/&quot;&gt;  </div><div class="line">            &lt;tx:method isolation=&quot;DEFAULT&quot; name=&quot;create*&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;Exception/&quot;&gt;  </div><div class="line">            &lt;tx:method isolation=&quot;DEFAULT&quot; name=&quot;insert*&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;Exception/&quot;&gt;  </div><div class="line">            &lt;tx:method isolation=&quot;DEFAULT&quot; name=&quot;del*&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;Exception/&quot;&gt;  </div><div class="line">            &lt;tx:method isolation=&quot;DEFAULT&quot; name=&quot;update*&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;Exception/&quot;&gt;  </div><div class="line">            &lt;tx:method name=&quot;*&quot; read-only=&quot;true/&quot;&gt;   </div><div class="line">        &lt;/tx:attributes&gt;  </div><div class="line">    &lt;/tx:advice&gt;  </div><div class="line">            </div><div class="line">           </div><div class="line">&lt;/beans&gt;</div></pre></td></tr></table></figure>
<h3 id="4、service业务类："><a href="#4、service业务类：" class="headerlink" title="4、service业务类："></a>4、service业务类：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">public class UserService &#123;  </div><div class="line">    private UserDao userDao;  </div><div class="line">    private LogDao logDao;  </div><div class="line">   </div><div class="line">    public void saveUser(String id, String name) &#123;  </div><div class="line">        userDao.insertUser(id, name);  </div><div class="line">        // int i = 1 / 0;  // 制造异常  </div><div class="line">        logDao.insertLog(id, id + _ + name);  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    public UserDao getUserDao() &#123;  </div><div class="line">        return userDao;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    public void setUserDao(UserDao userDao) &#123;  </div><div class="line">        this.userDao = userDao;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    public LogDao getLogDao() &#123;  </div><div class="line">        return logDao;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    public void setLogDao(LogDao logDao) &#123;  </div><div class="line">        this.logDao = logDao;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5、dao类："><a href="#5、dao类：" class="headerlink" title="5、dao类："></a>5、dao类：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class UserDao extends JdbcDaoSupport &#123;  </div><div class="line">    public void insertUser(String id, String name) &#123;  </div><div class="line">        JdbcTemplate template = getJdbcTemplate();  </div><div class="line">        template.execute(insert into user values(&apos; + id + &apos;,&apos; + name + &apos;));  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class LogDao extends JdbcDaoSupport &#123;  </div><div class="line">    public void insertLog(String id, String content) &#123;  </div><div class="line">        JdbcTemplate template = getJdbcTemplate();  </div><div class="line">        template.execute(insert into log values(&apos; + id + &apos;,&apos; + content + &apos;));  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="6、测试类："><a href="#6、测试类：" class="headerlink" title="6、测试类："></a>6、测试类：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class UserTest &#123;  </div><div class="line">    @Test  </div><div class="line">    public void testSave() &#123;  </div><div class="line">        ApplicationContext cxt = new ClassPathXmlApplicationContext(ApplicationContext.xml);  </div><div class="line">        UserService us = (UserService) cxt.getBean(userService);  </div><div class="line">        us.saveUser(1, zhangsan);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      java分布式事务:spring+JTA+jotm
    
    </summary>
    
      <category term="java" scheme="http://jishusuishouji.github.io/categories/java/"/>
    
    
      <category term="java" scheme="http://jishusuishouji.github.io/tags/java/"/>
    
      <category term="jta" scheme="http://jishusuishouji.github.io/tags/jta/"/>
    
      <category term="jotm" scheme="http://jishusuishouji.github.io/tags/jotm/"/>
    
      <category term="spring" scheme="http://jishusuishouji.github.io/tags/spring/"/>
    
  </entry>
  
</feed>
